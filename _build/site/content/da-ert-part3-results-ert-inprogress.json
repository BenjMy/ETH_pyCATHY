{"kind":"Notebook","sha256":"b99192a1ea9684f7577cb7b7bd2d3cb6b3126029886f77994673832a4e3dcbbb","slug":"da-ert-part3-results-ert-inprogress","location":"/notebook/DA_ERT_part3_results-ERT_inprogress.ipynb","dependencies":[],"frontmatter":{"title":"Working with pyCATHY and DA with ERT datasets","subtitle":"PART3 - plotting the **Archie** transformation results","github":"https://github.com/BenjMy/ETH_pyCATHY/","authors":[{"nameParsed":{"literal":"Benjamin Mary","given":"Benjamin","family":"Mary"},"name":"Benjamin Mary","orcid":"0000-0001-7199-2885","corresponding":true,"email":"benjamin.mary@ica.csic.es","affiliations":["ICA-CSIC"],"id":"contributors-DA_ERT_part3_results-ERT_inprogress-generated-uid-0"}],"affiliations":[{"id":"ICA-CSIC","name":"ICA-CSIC"}],"date":"2024/04/12","license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"}},"subject":"Tutorial","kernelspec":{"name":"python3","language":"python","display_name":"Python 3 (ipykernel)"},"keywords":[],"thumbnail":"/fedda32be756a7bce4ae368a71151cc1.png","exports":[{"format":"ipynb","filename":"DA_ERT_part3_results-ERT_inprogress.ipynb","url":"/DA_ERT_part3_results-521b7b28fe5565f9263b95f78e6541cb.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"image","url":"/fedda32be756a7bce4ae368a71151cc1.png","alt":"image.png","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RZ5YGoDOEj","urlSource":"data:image/png;base64,iVBORw0KGg...lFTkSuQmCC"}],"key":"adtIQZsg8d"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The notebooks describe:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wNMqeoLGeR"}],"key":"lgJnLoqKWA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plot outputs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TsoJaDQM2H"}],"key":"Wmfo2ovOQT"},{"type":"text","value":": analysis of the results","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"a9s1ixtGAE"}],"key":"micZOSNP6J"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Saturation with uncertainties","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XCCr4wbhKK"}],"identifier":"plot_states","label":"plot_states","kind":"heading","template":"{name}","resolved":true,"html_id":"plot-states","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"znC8Dkb9Lt"}],"key":"UQEytOugvK"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Parameters convergence","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"PVgQfXrxNz"}],"identifier":"parm_evol","label":"Parm_evol","kind":"heading","template":"{name}","resolved":true,"html_id":"parm-evol","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"vOdAHeYo3k"}],"key":"QlgN5PazO2"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Assimilation performance","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xMb0McgLks"}],"identifier":"da_perf","label":"DA_perf","kind":"heading","template":"{name}","resolved":true,"html_id":"da-perf","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"tuniGIQpXE"}],"key":"otT5SuG399"}],"key":"pdg2mry1eS"}],"key":"AiM2TpzVh2"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"import pyCATHY\nfrom pyCATHY import cathy_tools\nfrom pyCATHY.DA.cathy_DA import DA, dictObs_2pd\nfrom pyCATHY.DA.perturbate import perturbate_parm\nfrom pyCATHY.DA import perturbate\nfrom pyCATHY.DA.observations import read_observations, prepare_observations, make_data_cov\nfrom pyCATHY.DA import performance\nfrom pyCATHY.ERT import petro_Archie as Archie\nimport pyCATHY.meshtools as cathy_meshtools\nimport pyvista as pv\nimport pyCATHY.plotters.cathy_plots as cplt \nimport os \nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\n# set some default plotting parameters for nicer looking plots\nmpl.rcParams.update({\"axes.grid\":True, \n                     \"grid.color\":\"gray\", \n                     \"grid.linestyle\":'--',\n                     'figure.figsize':(6,6)}\n                   )\nimport pandas as pd\nimport utils","key":"mL3aAStWRp"},{"type":"output","id":"0DDGrtGSsbdVTz1guCR9y","data":[],"key":"SPKEMPIZ8g"}],"key":"oBDRxeUjyB"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"import pygimli as pg \nfrom pygimli.physics import ert","key":"cdeaYjAIa0"},{"type":"output","id":"Ugs3HGGXKxNMvgME2n1Ky","data":[],"key":"yBvYioPdCY"}],"key":"A6zHZK4uZC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Analysis of the results","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"PBfQfiYx0a"}],"identifier":"plot_results","label":"plot_results","html_id":"plot-results","key":"FvEixuvABl"}],"key":"XBoWfJDZMm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reload solution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"d8KQLLqguf"}],"identifier":"reload-solution","label":"Reload solution","html_id":"reload-solution","implicit":true,"key":"XCchvxhu02"}],"key":"pTG7EvHPVp"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"simu_solution = cathy_tools.CATHY(\n                                    dirName='./solution_ERT',\n                                    prj_name= 'weill_dataset',\n                                    notebook=True,\n                                  )\nsw_SOL, sw_SOL_times = simu_solution.read_outputs('sw')\npsi_SOL = simu_solution.read_outputs('psi')\n\nrootMap, rootMap_hd = simu_solution.read_inputs('root_map')\n\nsoil_SPP_SOL, soil_FP_SOL = simu_solution.read_inputs('soil',\n                                                         MAXVEG=int(np.max(rootMap)),\n                                                    )\nPERMX_SOL = soil_SPP_SOL['PERMX'].unique()[0]\nPOROS_SOL = soil_SPP_SOL['POROS'].unique()[0]","key":"U2Njngk4ho"},{"type":"output","id":"ezVDmew3BEsxVJLw38ob0","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}}],"key":"PTJSZjoghn"}],"key":"iWbx8w9BBA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot saturation 2D solution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sm6RBlw1jE"}],"identifier":"plot-saturation-2d-solution","label":"Plot saturation 2D solution","html_id":"plot-saturation-2d-solution","implicit":true,"key":"BwZDnUHYxB"}],"key":"VrpwLPUpyY"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"pl = pv.Plotter(shape=(2, 2))\naxis_pl = [(0,0),(0,1),(1,0),(1,1)]\nfor i, j in enumerate([0,2,5,10]):\n    mesh = pv.read(os.path.join(simu_solution.workdir,\n                                'solution_ERTsaturation_nearIntrp2_pg_msh' + str(j) + '.vtk',\n                                )\n    \n           )\n    pl.subplot(axis_pl[i][0],axis_pl[i][1])\n    pl.add_mesh(mesh,\n               scalars='saturation_nearIntrp2_pg_msh',\n                lighting=False,\n                cmap=\"jet_r\"\n               )\n    pl.view_xz()\npl.show()","key":"JGy6zl3ygT"},{"type":"output","id":"dg5zK5DZn0R1eVvu75UNZ","data":[{"output_type":"display_data","metadata":{},"data":{"image/jpeg":{"content_type":"image/jpeg","hash":"6e31cb55382345f831227f14f8430ca4","path":"/6e31cb55382345f831227f14f8430ca4.jpeg"},"image/png":{"content_type":"image/png","hash":"6ae9872eb651581ce270554502af7ba2","path":"/6ae9872eb651581ce270554502af7ba2.png"},"text/plain":{"content":"<PIL.Image.Image image mode=RGB size=1024x768>","content_type":"text/plain"}}}],"key":"F05tYGiBN2"}],"key":"t6LXjvkhbO"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Going further with pygimli Time Lapse","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KCYqRqWLhh"}],"identifier":"going-further-with-pygimli-time-lapse","label":"Going further with pygimli Time Lapse","html_id":"going-further-with-pygimli-time-lapse","implicit":true,"key":"nvW8SiTlJj"}],"key":"lsWuOhf5Bg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In case we want to see the results in term of ER, we can invert the apparent resistivities. See: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"t765f5UfMj"},{"type":"link","url":"https://www.pygimli.org/_examples_auto/3_ert/plot_09_timelapse.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://‚Äãwww‚Äã.pygimli‚Äã.org‚Äã/‚Äã_examples‚Äã_auto‚Äã/3‚Äã_ert‚Äã/plot‚Äã_09‚Äã_timelapse‚Äã.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ncua2aDj2K"}],"urlSource":"https://www.pygimli.org/_examples_auto/3_ert/plot_09_timelapse.html","key":"uaca4ISBuh"}],"key":"tOb5ZcJNcN"},{"type":"code","lang":"","value":"for i in range(10):\n    rhoa = pg.load('filenameRhoa_synthetic')\n    DATA.append(rhoa)\n\ntl = ert.TimelapseERT(DATA)\ntl.invert(zWeight=0.3, lam=100)\ntl.showAllModels();","position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"key":"zCmNiTzNtq"}],"key":"NoxEnRYS9u"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reload DA results","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BxhA6uzFUr"}],"identifier":"reload-da-results","label":"Reload DA results","html_id":"reload-da-results","implicit":true,"key":"l1xGPgCdPG"}],"key":"xd3AsmZYaq"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"simuWithDA = DA(\n                        dirName='./DA_ERT',\n                        prj_name= 'Weill_example_withDA',\n                        notebook=True,\n                    )\nsimuWithoutDA = DA(\n                        dirName='./DA_ERT',\n                        prj_name= 'Weill_example_withoutDA',\n                        notebook=True,\n                    )","key":"IFS0bufsmU"},{"type":"output","id":"6eeNL_IARpP9dld4RBULP","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}}],"key":"s3sewc0lqi"}],"key":"XZRba4Ga0O"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA = simuWithDA.load_pickle_backup()\nresults_withoutDA = simuWithoutDA.load_pickle_backup()","key":"wiFKa4l8Nd"},{"type":"output","id":"BWIXgaqTPdu2F9BRvH45o","data":[],"key":"pFQJhwUNNB"}],"key":"InONu7b1sz"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"observations = dictObs_2pd(results_withDA['dict_obs'])\n#observations.xs('ERT',0).iloc[0]['elecs']","key":"qIXf9rBFkQ"},{"type":"output","id":"LbyJ7oTPf0C4eowvvGQHf","data":[],"key":"i0kl319t0y"}],"key":"buvkU14IMx"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"tobs= observations.index.get_level_values(1).to_list()","key":"FTJ4LDHwGd"},{"type":"output","id":"IcGSy4uFBuQcTuoeE7Q2e","data":[],"key":"bMPJ3qnA2O"}],"key":"oIp1qN2cEg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ERT simulate","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"W6dhCluQvX"}],"identifier":"ert-simulate","label":"ERT simulate","html_id":"ert-simulate","implicit":true,"key":"KCDMBhcrvU"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we simulate the apparent resistivities from the mean/min/max of the ensemble generated from data assimilation for each steps.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OzLMEvkjaP"}],"key":"y70IPABuEr"}],"key":"iyznNtC6hX"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"os.getcwd()","key":"h3y5gIe6rB"},{"type":"output","id":"dJD8ZqZb1eUdQ6uVGZlnr","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"'/home/z0272571a@CAMPUS.CSIC.ES/Nextcloud/BenCSIC/Codes/BenjMy/ETH_pyCATHY/notebooks'","content_type":"text/plain"}}}],"key":"j0iFz5YDgq"}],"key":"Hg7HxTrHzj"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshCiPG_PGref = pv.read('./solution_ERT/meshCi.vtk')\nmeshLiPG_PGref = pv.read('./solution_ERT/meshLi.vtk')\n(meshCiPG, meshLiPG) = utils.define_mesh_transformations(meshCiPG_PGref,\n                                                      meshLiPG_PGref,\n                                                      idC=10, \n                                                      idL=10,\n                                                    )","key":"DDj9kDqZj5"},{"type":"output","id":"5eWyjk9wGUkdZMgJNHeSA","data":[],"key":"DzWSAkhCs5"}],"key":"QDa4MNojuD"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLiPG","key":"Hg4mjy30yU"},{"type":"output","id":"xrfT1sSmBGBgSvp9sHGi_","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content":"<table style='width: 100%;'><tr><th>Header</th><th>Data Arrays</th></tr><tr><td>\n<table style='width: 100%;'>\n<tr><th>UnstructuredGrid</th><th>Information</th></tr>\n<tr><td>N Cells</td><td>3114</td></tr>\n<tr><td>N Points</td><td>1658</td></tr>\n<tr><td>X Bounds</td><td>0.000e+00, 1.000e+01</td></tr>\n<tr><td>Y Bounds</td><td>5.000e+00, 5.000e+00</td></tr>\n<tr><td>Z Bounds</td><td>-1.000e+00, 7.500e-01</td></tr>\n<tr><td>N Arrays</td><td>1</td></tr>\n</table>\n\n</td><td>\n<table style='width: 100%;'>\n<tr><th>Name</th><th>Field</th><th>Type</th><th>N Comp</th><th>Min</th><th>Max</th></tr>\n<tr><td><b>Marker</b></td><td>Cells</td><td>float64</td><td>1</td><td>1.000e+00</td><td>1.000e+00</td></tr>\n</table>\n\n</td></tr> </table>","content_type":"text/html"},"text/plain":{"content":"UnstructuredGrid (0x7f3651daa860)\n  N Cells:    3114\n  N Points:   1658\n  X Bounds:   0.000e+00, 1.000e+01\n  Y Bounds:   5.000e+00, 5.000e+00\n  Z Bounds:   -1.000e+00, 7.500e-01\n  N Arrays:   1","content_type":"text/plain"}}}],"key":"zCvLckuxAR"}],"key":"jVZBv40t0W"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"meshLiPG is composed of 3114 cells and 1658 nodes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e9mpKxfDb3"}],"key":"nGwaP6Wmpb"}],"key":"Ix5NTzsgfQ"}],"key":"sU698EvU3r"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"pl = pv.Plotter()\npl.add_mesh(meshCiPG)\npl.add_mesh(meshLiPG)\n#pl.add_mesh(meshCATHY,opacity=0.5)\npl.show_grid()\npl.show()","key":"MTHJlzZOYE"},{"type":"output","id":"ay8dvSf_xfOK6FGZlJfc0","data":[{"output_type":"display_data","metadata":{},"data":{"image/jpeg":{"content_type":"image/jpeg","hash":"3d94c89eece1c805a6a26d55da8602f4","path":"/3d94c89eece1c805a6a26d55da8602f4.jpeg"},"image/png":{"content_type":"image/png","hash":"0a59c637b77ab96fdbe7b19cf8fa1d13","path":"/0a59c637b77ab96fdbe7b19cf8fa1d13.png"},"text/plain":{"content":"<PIL.Image.Image image mode=RGB size=1024x768>","content_type":"text/plain"}}}],"key":"NR3lwFpUBe"}],"key":"Ht61wA2UYB"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"ERT_meta_dict_meshLi={\n                'forward_mesh_vtk_file': './solution_ERT/meshLi.vtk',\n                'mesh_nodes_modif': meshLiPG.points\n}","key":"BcwnyZkjdK"},{"type":"output","id":"kNZvJTS1MrmV8t4yyN33Q","data":[],"key":"QAD7WU8AHo"}],"key":"ktjtGgoNyY"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define Archie Parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ab8GQfpC2H"}],"identifier":"define-archie-parameters","label":"Define Archie Parameters","html_id":"define-archie-parameters","implicit":true,"key":"FCNPqQTws2"}],"key":"yoPnv187ep"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"sc = {}\nrFluid_Archie = 1/(588*(1e-6/1e-2))\nsc = {\n    \"POROS\": [POROS_SOL],\n    \"rFluid_Archie\": [rFluid_Archie],\n    \"a_Archie\": [0.3],\n    \"m_Archie\": [1.7],\n    \"n_Archie\": [1.7],\n    \"pert_sigma_Archie\": [0],\n}","key":"nlyEC5qoEA"},{"type":"output","id":"q5EZv4eb5m0d2uhe9Zkvd","data":[],"key":"ydF6FLal5M"}],"key":"u120pitX7G"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"","key":"QhS45R9E6j"},{"type":"output","id":"rPhSUsHsJGJqhFVjj9JRD","data":[{"ename":"NameError","evalue":"name 'meshCATHY' is not defined","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)\nCell \u001b[0;32mIn[32], line 1\u001b[0m\n\u001b[0;32m----> 1\u001b[0m meshLi_PG_withSaturation, scalar_new \u001b[38;5;241m=\u001b[39m cathy_meshtools\u001b[38;5;241m.\u001b[39mCATHY_2_pg(meshCATHY,\n\u001b[1;32m      2\u001b[0m                                                                   ERT_meta_dict_meshLi,\n\u001b[1;32m      3\u001b[0m                                                                   \u001b[38;5;66;03m# show=True,\u001b[39;00m\n\u001b[1;32m      4\u001b[0m                                                                   )\n\n\u001b[0;31mNameError\u001b[0m: name 'meshCATHY' is not defined"}],"key":"tP0EyGE3sA"}],"key":"zfuVBCCqaA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create ERT scheme","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H8EaSMSVg5"}],"identifier":"create-ert-scheme","label":"Create ERT scheme","html_id":"create-ert-scheme","implicit":true,"key":"oj6vipO8hE"}],"key":"XjZiuvipcA"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"scheme = ert.createData(elecs=np.linspace(start=0, \n                                          stop=10, \n                                          num=21),\n                           schemeName='dd')","key":"R57xBMvecB"},{"type":"output","id":"s2oZa_x5X_dcpUInCRuCX","data":[],"key":"N11r2i8uPq"}],"key":"aXax52H4Nx"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLi = pg.load(ERT_meta_dict_meshLi['forward_mesh_vtk_file'])","key":"dTjCSuT0Fj"},{"type":"output","id":"cmuHwj2GbI3AGpGHaOAXg","data":[],"key":"ViJICL3Wkj"}],"key":"DAWrFlCX1O"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"sw_bef_update_withDA_ens1 = results_withDA['df_DA'].set_index(['time','Ensemble_nb'])['sw_bef_update_'].xs((1,0))","key":"l9ICxB80em"},{"type":"output","id":"xKNAHZTlR0hV2QbXjunYD","data":[],"key":"vrroj7BHXg"}],"key":"doAHWe0B66"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA_Archie = results_withDA['df_Archie'].set_index(['time','ens_nbi'])\nresults_withDA_Archie","key":"NAnNj58pfz"},{"type":"output","id":"vzrSKdpIqU31MkhoDEcOG","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>ens_nb</th>\n      <th>sw</th>\n      <th>ER_converted</th>\n      <th>OL</th>\n      <th>porosity</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th>ens_nbi</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">0.0</th>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672994</td>\n      <td>27.638137</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672602</td>\n      <td>27.665519</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672672</td>\n      <td>27.660611</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672713</td>\n      <td>27.657710</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672787</td>\n      <td>27.652588</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">9.0</th>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313890</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272769</td>\n      <td>128.314130</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n  </tbody>\n</table>\n<p>1439424 rows √ó 5 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"             ens_nb        sw  ER_converted   OL  porosity\ntime ens_nbi                                              \n0.0  0.0        NaN  0.672994     27.638137  0.0      0.55\n     0.0        NaN  0.672602     27.665519  0.0      0.55\n     0.0        NaN  0.672672     27.660611  0.0      0.55\n     0.0        NaN  0.672713     27.657710  0.0      0.55\n     0.0        NaN  0.672787     27.652588  0.0      0.55\n...             ...       ...           ...  ...       ...\n9.0  31.0       NaN  0.272770    128.313890  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272769    128.314130  0.0      0.55\n\n[1439424 rows x 5 columns]","content_type":"text/plain"}}}],"key":"b5RcC8fdUL"}],"key":"AzjWRcRfEA"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"rhomap = results_withDA_Archie.xs((0,0))['ER_converted'].values\nlen(rhomap)\n","key":"XyN2CuWeht"},{"type":"output","id":"psDLmpz3EB0xKtcVIwAjf","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"7056","content_type":"text/plain"}}}],"key":"Ivv3myuZe8"}],"key":"nsr9E6QRj6"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"len(rhomap)","key":"iePAySagHi"},{"type":"output","id":"iBj8D4rarZhOi2KTiMqIm","data":[{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"7056","content_type":"text/plain"}}}],"key":"vGD2MAsqwu"}],"key":"BJEggdPHUg"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLi","key":"pfoCnvhLhA"},{"type":"output","id":"pVNs1J3gS0RPT1qxP4TCy","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"Mesh: Nodes: 1658 Cells: 3114 Boundaries: 4771\nMesh contains data: Marker","content_type":"text/plain"}}}],"key":"VjSuUE4qt2"}],"key":"jvKTNCu1Jo"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"os.getcwd()","key":"aCzbEnxXVF"},{"type":"output","id":"eeX6jOJ5wK9RKW25V1wYs","data":[{"output_type":"execute_result","execution_count":28,"metadata":{},"data":{"text/plain":{"content":"'/home/z0272571a@CAMPUS.CSIC.ES/Nextcloud/BenCSIC/Codes/BenjMy/ETH_pyCATHY/notebooks'","content_type":"text/plain"}}}],"key":"pE1BrWNPm3"}],"key":"ZSUQC6AXi7"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"for i in range(len(tatmbc)):\n\n    # read in CATHY mesh data\n    # ------------------------------------------------------------------------\n    path_CATHY = os.path.join(simu_solution.workdir, \n                              simu_solution.project_name , \n                              'vtk/'\n                              )\n    if i<10:    \n        filename = \"10\" + str(i) + \".vtk\"\n    elif i<100:\n        filename = \"1\" + str(i) + \".vtk\"\n    \n    meshCATHY = pv.read(path_CATHY+filename)\n            \n    meshLi_PG_withSaturation, scalar_new = cathy_meshtools.CATHY_2_pg(meshCATHY,\n                                                                      ERT_meta_dict_meshLi,\n                                                                      # show=True,\n                                                                      )","key":"fyFCVxySdB"},{"type":"output","id":"8EG2PDcBC4_7wFZLJCSUz","data":[],"key":"fsBQGTM2FV"}],"key":"D8aWA8HD7Z"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"\nfor i in range(len(tobs)):\n    rhomap = results_withDA_Archie.xs((0,0))['ER_converted'].values\n    print(rhomap)\n\n    meshLi_PG_withSaturation, scalar_new = cathy_meshtools.CATHY_2_pg(meshCATHY,\n                                                                  ERT_meta_dict_meshLi,\n                                                                  # show=True,\n                                                                  )\n\n    ER_converted_ti_noNoise = Archie.Archie_rho_DA(\n                                               sat = [saturation],\n                                               rFluid_Archie=sc['rFluid_Archie'], \n                                               porosity=sc['POROS'], \n                                               a_Archie=sc['a_Archie'], \n                                               m_Archie=sc['m_Archie'], \n                                               n_Archie=sc['n_Archie'],\n                                               pert_sigma_Archie=[0]\n                                               )\n\n    data = ert.simulate(meshLi, \n                        scheme=scheme, \n                        res=rhomap, \n                        noiseLevel=1,\n                        noiseAbs=1e-6, \n                        seed=1337\n                        )\n    print(i)\n    data.save('DA_ERT/ERTsimuWithDA/ERT_Li_' + str(i) + '.data')","key":"uQtVU4nfk6"},{"type":"output","id":"C_Pb-klJoDaq8xcswzffF","data":[{"name":"stdout","output_type":"stream","text":"[27.6381372  27.66551909 27.66061108 ... 14.09702132 14.09702132\n 14.09702132]\nModellingBase::setMesh() copying new mesh ... Found Neumann domain. Setting topography=1.\nFound Neumann domain. but 2.5D -> neumann: false\nMesh: Nodes: 1658 Cells: 3114 Boundaries: 4771\nMesh contains data: Marker\nres:  [27.6381372  27.66551909 27.66061108 ... 14.09702132 14.09702132\n 14.09702132]\nFound datafile: 21 electrodes\nFound: 21 free-electrodes\nrMin = 0.25, rMax = 20\nNGauLeg + NGauLag for inverse Fouriertransformation: 11 + 4\nFound non-Neumann domain\n0.00733017 s\nFOP updating mesh dependencies ... 1.072e-06 s\n"},{"ename":"BaseException","evalue":"Simulate called with wrong resistivity array.","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mBaseException\u001b[0m                             Traceback (most recent call last)\nCell \u001b[0;32mIn[29], line 4\u001b[0m\n\u001b[1;32m      2\u001b[0m rhomap \u001b[38;5;241m=\u001b[39m results_withDA_Archie\u001b[38;5;241m.\u001b[39mxs((\u001b[38;5;241m0\u001b[39m,\u001b[38;5;241m0\u001b[39m))[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mER_converted\u001b[39m\u001b[38;5;124m'\u001b[39m]\u001b[38;5;241m.\u001b[39mvalues\n\u001b[1;32m      3\u001b[0m \u001b[38;5;28mprint\u001b[39m(rhomap)\n\u001b[0;32m----> 4\u001b[0m data \u001b[38;5;241m=\u001b[39m ert\u001b[38;5;241m.\u001b[39msimulate(meshLi, \n\u001b[1;32m      5\u001b[0m                     scheme\u001b[38;5;241m=\u001b[39mscheme, \n\u001b[1;32m      6\u001b[0m                     res\u001b[38;5;241m=\u001b[39mrhomap, \n\u001b[1;32m      7\u001b[0m                     noiseLevel\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1\u001b[39m,\n\u001b[1;32m      8\u001b[0m                     noiseAbs\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1e-6\u001b[39m, \n\u001b[1;32m      9\u001b[0m                     seed\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1337\u001b[39m\n\u001b[1;32m     10\u001b[0m                     )\n\u001b[1;32m     11\u001b[0m \u001b[38;5;28mprint\u001b[39m(i)\n\u001b[1;32m     12\u001b[0m data\u001b[38;5;241m.\u001b[39msave(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mDA_ERT/ERTsimuWithDA/ERT_Li_\u001b[39m\u001b[38;5;124m'\u001b[39m \u001b[38;5;241m+\u001b[39m \u001b[38;5;28mstr\u001b[39m(i) \u001b[38;5;241m+\u001b[39m \u001b[38;5;124m'\u001b[39m\u001b[38;5;124m.data\u001b[39m\u001b[38;5;124m'\u001b[39m)\n\nFile \u001b[0;32m~/miniconda3/envs/pgCATHY/lib/python3.11/site-packages/pygimli/physics/ert/ert.py:215\u001b[0m, in \u001b[0;36msimulate\u001b[0;34m(mesh, scheme, res, **kwargs)\u001b[0m\n\u001b[1;32m    213\u001b[0m         \u001b[38;5;28mprint\u001b[39m(mesh)\n\u001b[1;32m    214\u001b[0m         \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mres: \u001b[39m\u001b[38;5;124m\"\u001b[39m, res)\n\u001b[0;32m--> 215\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m(\n\u001b[1;32m    216\u001b[0m             \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mSimulate called with wrong resistivity array.\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    218\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m isArrayData:\n\u001b[1;32m    219\u001b[0m     ret[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mrhoa\u001b[39m\u001b[38;5;124m'\u001b[39m] \u001b[38;5;241m=\u001b[39m rhoa\n\n\u001b[0;31mBaseException\u001b[0m: Simulate called with wrong resistivity array."}],"key":"mDhXDK57OF"}],"key":"baY6u8EKo6"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Archie","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"KVNNXHdvqV"}],"identifier":"archie","label":"Archie","html_id":"archie","implicit":true,"key":"JOCuGqJ0BM"}],"key":"wLnNmHPwIA"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA.keys()","key":"au2vFliJ3O"},{"type":"output","id":"1m6rmXXO9W3E2_H3DIgrP","data":[],"key":"GVj9Xvst6O"}],"key":"gHUZQ6ASmg"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie = results_withDA['df_Archie']\nArchie_ER = Archie.set_index(['time','ens_nbi'])\nArchie_ER","key":"iOO5nCbkJr"},{"type":"output","id":"FNaHDH8Y3NuyBQumt6slE","data":[],"key":"JChQfNghgO"}],"key":"DDy6t9ygfS"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie.time.unique()","key":"xPWd2ar3kC"},{"type":"output","id":"iokTU-8xeExDyP--bG-D7","data":[],"key":"jLfBoq3rQ2"}],"key":"FsPNQz6vrw"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meanArchie = Archie.groupby('time')['ER_converted'].mean()\nminArchie = Archie.groupby('time')['ER_converted'].min()\nmaxArchie = Archie.groupby('time')['ER_converted'].max()\nminArchie","key":"uABYDf7ejj"},{"type":"output","id":"Wm8c3q_KSoZ3JqbLWxLi3","data":[],"key":"sOAT37hDvM"}],"key":"bYPj52wdLJ"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots()\nminArchie.plot(ax=ax)\nmaxArchie.plot(ax=ax)\nmeanArchie.plot(ax=ax)\nax.set_xlabel('# Assimilation')\nax.set_ylabel('ER converted')\n","key":"I53TTRN5pw"},{"type":"output","id":"7ziA19NDci-QAVIhgVUvH","data":[],"key":"oazwWmtJZy"}],"key":"E19AgvaAcv"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot 1:1 line between observed ER and estimated ER","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"S2WwKvPnWv"}],"identifier":"plot-1-1-line-between-observed-er-and-estimated-er","label":"Plot 1:1 line between observed ER and estimated ER","html_id":"plot-1-1-line-between-observed-er-and-estimated-er","implicit":true,"key":"audlvPbEDv"}],"key":"LD0kXnLIXp"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie['ER_converted']","key":"liXWCYm939"},{"type":"output","id":"exHgkvaxXd814UF2ajUAJ","data":[],"key":"UtV3Ac5y17"}],"key":"n7TTYjDIko"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"metadata_ERT    = {\n                    'data_type': '$ERT$', # units\n                    'units': '$\\Ohm$', # units transfer_resistances\n                    'forward_mesh_vtk_file': '../solution_ERT/meshLi.vtk', # path to the ERT mesh (vtk file compatible with pygimli or resipy)\n                    # 'sequenceERT': sequenceERT, # path to the ERT sequence  (file compatible with pygimli or resipy)\n                    # 'instrument': 'Syscal', # Instrument\n                    'data_format': 'pygimli', # format (raw or preprocessed)\n                    'dataErr': 0.5, # error in %\n                    'fwdNoiseLevel': 5, # error in %\n                    #'mesh_nodes_modif': meshLiPG.points, \n        \n                }","key":"dfuATThwV9"},{"type":"output","id":"pGh5fUjUQyl-3POEJ-sSv","data":[],"key":"amZwh0sIlO"}],"key":"KAoc8wEOAl"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"dict_obs = {}\nfor i, tt in enumerate(Archie.time.unique()):\n\n    if i == 0:\n        continue\n    \n    # .data file observation generated by pygimli\n    filename = os.path.join(simu_solution.workdir,\n                            'ERTsolution', \n                            'ERT_Li_' + str(i) + '.data'\n                            )    \n    data_measure = read_observations(\n                                    dict_obs,\n                                    filename, \n                                    data_type = 'ERT', \n                                    data_err = 0.5,\n                                    show=True,\n                                    tA=tt,\n                                    obs_cov_type='data_err', #data_err\n                                    meta=metadata_ERT,\n                                    ) \ndata_measure_df = dictObs_2pd(dict_obs) ","key":"e6lCPvAGQ5"},{"type":"output","id":"cuKWxk2GzSARgnbd4FYKV","data":[],"key":"yZPRr5Rf1T"}],"key":"OLtEMXfBOy"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data_rhoa = data_measure_df.xs('ERT')['data']\ndata_rhoa.iloc[0].head()","key":"TpBMe44R2l"},{"type":"output","id":"-xyoQy9_nFAT2D6KzI2Aj","data":[],"key":"fsVyzYqCBV"}],"key":"GbY2Dd0ZEy"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots() \nax.scatter(data_rhoa.iloc[0]['rhoa'].values,\n           Archie.groupby('ens_nbi')['ER_converted'].mean().values\n          )\n           ","key":"SP3SVdmgA5"},{"type":"output","id":"b50NdSJN0RpBo1uHUFr41","data":[],"key":"dHFCwy13WE"}],"key":"wDAUqxaHo4"}],"key":"UgfHH8Eszi"},"references":{"cite":{"order":[],"data":{}}}}