# Twin experiments to test DA
 
This project aims to validate and assess the effectiveness of data assimilation (DA) techniques by conducting a twin experiment with:
- Soil moisture content (SMC) data
- Electrical Resistivity Tomography (ERT) 2d profiles 
- Actual Evapotranspiration(ET) from EO (Earth Observations)

**True State Generation**
The true state of soil moisture is generated by running a hydrological model with **known parameters and forcing data** over a 24-hour period. This true state serves as the synthetic reality for the experiment.

```{figure} ./lib/solution_SMC/weill_dataset/atmbc.png
:name: true-state-atmbc
:width: 600px
:align: center

True-state-atmbc
```


```{figure} ./lib/DA_ERT/meshLi_withDA_ic/vtksaturation_slow.gif
:name: true-state-figure
:width: 600px
:align: center

True state generation for soil moisture over a 24-hour period.
```

**Perturbed Initial State**
A new simulation of the hydrological model is initiated with perturbed initial conditions and/or parameters. This represents the model's initial guess, which deviates from the true state.

```{figure} ./lib/DA_ERT/meshLi_withDA_ic/meshLi_withDA_icic.png
:name: meshLi_withDA_ZROOT_WITH_UPDATEZROOT0
:width: 600px
:align: center

meshLi_withDA_ZROOT_WITH_UPDATEZROOT0
```


```{figure} ./lib/DA_ERT/meshLi_withDA_ZROOT_WITH_UPDATE/meshLi_withDA_ZROOT_WITH_UPDATEZROOT0.png
:name: meshLi_withDA_ZROOT_WITH_UPDATEZROOT0
:width: 600px
:align: center

meshLi_withDA_ZROOT_WITH_UPDATEZROOT0
```





**Data Assimilation**
The synthetic observations are assimilated into the hydrological model using the Ensemble Kalman Filter (EnKF) method. This process updates the model state to better match the observations.

**Analysis and Evaluation**
The performance of the data assimilation is evaluated by comparing the assimilated model state with the true state. Metrics such as root mean square error (RMSE) are used to quantify the accuracy of the assimilation.

## SMC at 3 depths
In this experiment, synthetic observations of soil moisture at three different depths are assimilated into a hydrological model every hour over a 24-hour period. Noise is added to the true solution to simulate real-world observation inaccuracies. A 5% Gaussian noise is added to these observations to mimic measurement errors.

 
### Initial conditions perturbations 
```{figure} ./lib/DA_SMC/SMC_withoutDA_ic/SMC_withoutDA_ic_sw.png
:name: SMC_withoutDA_icsw
:width: 600px
:align: center

SMC_withoutDA_icsw
```

```{figure} ./lib/DA_SMC/SMC_withDA_ic/SMC_withDA_ic_sw.png
:name: SMC_withoutDA_icsw
:width: 600px
:align: center

SMC_withDA_icsw
```
### Root depth conditions perturbations and update

```{figure} ./lib/DA_SMC/SMC_withoutDA_ZROOT_WITH_UPDATE/SMC_withoutDA_ZROOT_WITH_UPDATE_sw.png
:name: SMC_withoutDA_icsw
:width: 600px
:align: center

SMC_withoutDA_icsw
```

```{figure} ./lib/DA_SMC/SMC_withDA_ZROOT_WITH_UPDATE/SMC_withDA_ZROOT_WITH_UPDATE_sw.png
:name: SMC_withoutDA_icsw
:width: 600px
:align: center

SMC_withDA_icsw
```

 
## ERT 2d profiles


```{figure} ./lib/solution_ERT/ERT_dataset/meshERT.png
:name: meshERT
:width: 600px
:align: center

meshERT
```


### Initial conditions perturbations 
```{code-block} TOML
[scenario.ic]
per_type = ["None"]
per_name = ["ic"]
per_nom = [-1]
per_mean = [-1]
per_sigma = [1.75]
per_bounds = ["None"]
sampling_type = ["normal"]
transf_type = ["None"]
listUpdateParm = ["St. var."]
```

```{figure} ./lib/DA_ERT/meshLi_withoutDA_ic/meshLi_withoutDA_ic_sw.png
:name: meshLi_withoutDA_ic_sw
:width: 600px
:align: center

meshLi_withoutDA_ic_sw
```


```{figure} ./lib/DA_ERT/meshLi_withDA_ic/meshLi_withDA_ic_sw.png
:name: meshLi_withDA_ic_sw
:width: 600px
:align: center

meshLi_withDA_ic_sw
```

### Root depth conditions perturbations and update

```{figure} ./lib/DA_ERT/meshLi_withoutDA_ZROOT_WITH_UPDATE/meshLi_withoutDA_ZROOT_WITH_UPDATE_sw.png
:name: meshLi_withoutDA_ZROOT_WITH_UPDATE_sw
:width: 600px
:align: center

meshLi_withoutDA_ZROOT_WITH_UPDATE_sw
```

```{figure} ./lib/DA_ERT/meshLi_withoutDA_ZROOT_WITH_UPDATE/meshLi_withoutDA_ZROOT_WITH_UPDATE_ZROOT.png
:name: meshLi_withoutDA_ZROOT_WITH_UPDATE_ZROOT
:width: 600px
:align: center

meshLi_withoutDA_ZROOT_WITH_UPDATE_ZROOT
```

```{figure} ./lib/DA_ERT/meshLi_withDA_ZROOT_WITH_UPDATE/meshLi_withDA_ZROOT_WITH_UPDATE_sw.png
:name: meshLi_withDA_ZROOT_WITH_UPDATE_sw
:width: 600px
:align: center

meshLi_withDA_ZROOT_WITH_UPDATE_sw
```

```{figure} ./lib/DA_ERT/meshLi_withDA_ZROOT_WITH_UPDATE/meshLi_withDA_ZROOT_WITH_UPDATE_ZROOT.png
:name: SMC_withoutDA_icsw
:width: 600px
:align: center

meshLi_withDA_ZROOT_WITH_UPDATE_ZROOT
```

## Actual ET

 
