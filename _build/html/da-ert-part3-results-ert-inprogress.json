{"kind":"Notebook","sha256":"b99192a1ea9684f7577cb7b7bd2d3cb6b3126029886f77994673832a4e3dcbbb","slug":"da-ert-part3-results-ert-inprogress","location":"/notebook/DA_ERT_part3_results-ERT_inprogress.ipynb","dependencies":[],"frontmatter":{"title":"Working with pyCATHY and DA with ERT datasets","subtitle":"PART3 - plotting the **Archie** transformation results","github":"https://github.com/BenjMy/ETH_pyCATHY/","authors":[{"nameParsed":{"literal":"Benjamin Mary","given":"Benjamin","family":"Mary"},"name":"Benjamin Mary","orcid":"0000-0001-7199-2885","corresponding":true,"email":"benjamin.mary@ica.csic.es","affiliations":["ICA-CSIC"],"id":"contributors-DA_ERT_part3_results-ERT_inprogress-generated-uid-0"}],"affiliations":[{"id":"ICA-CSIC","name":"ICA-CSIC"}],"date":"2024/04/12","license":{"content":{"id":"CC-BY-4.0","name":"Creative Commons Attribution 4.0 International","free":true,"CC":true,"url":"https://creativecommons.org/licenses/by/4.0/"}},"subject":"Tutorial","keywords":[],"thumbnail":"/build/fedda32be756a7bce4ae368a71151cc1.png","exports":[{"format":"ipynb","filename":"DA_ERT_part3_results-ERT_inprogress.ipynb","url":"/build/DA_ERT_part3_results-521b7b28fe5565f9263b95f78e6541cb.ipynb"}]},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"image","url":"/build/fedda32be756a7bce4ae368a71151cc1.png","alt":"image.png","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jK4nFvm3zW","urlSource":"data:image/png;base64,iVBORw0KGg...lFTkSuQmCC"}],"key":"WD9sHsaYkt"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The notebooks describe:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"grE87PhqDi"}],"key":"AusgGEpUlH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plot outputs","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Vjw2zTQF73"}],"key":"fkYt40J0NZ"},{"type":"text","value":": analysis of the results","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NrALv8UJq4"}],"key":"ks8XIUJYl9"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":4,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Saturation with uncertainties","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Nutch779uA"}],"identifier":"plot_states","label":"plot_states","kind":"heading","template":"{name}","resolved":true,"html_id":"plot-states","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"yTTrbMU7XG"}],"key":"rjcMIWuie1"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Parameters convergence","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"WglR8tA9Dz"}],"identifier":"parm_evol","label":"Parm_evol","kind":"heading","template":"{name}","resolved":true,"html_id":"parm-evol","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"EQx9AdwFb6"}],"key":"eDn5pmIjh1"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Assimilation performance","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"jUGD3oIakd"}],"identifier":"da_perf","label":"DA_perf","kind":"heading","template":"{name}","resolved":true,"html_id":"da-perf","remote":true,"url":"/da-ert-part3-results-archie-inprogress","dataUrl":"/da-ert-part3-results-archie-inprogress.json","key":"i0mXLPWi5W"}],"key":"hZQfo4UW60"}],"key":"DufTrWby7N"}],"key":"dfkMsHUTwD"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"import pyCATHY\nfrom pyCATHY import cathy_tools\nfrom pyCATHY.DA.cathy_DA import DA, dictObs_2pd\nfrom pyCATHY.DA.perturbate import perturbate_parm\nfrom pyCATHY.DA import perturbate\nfrom pyCATHY.DA.observations import read_observations, prepare_observations, make_data_cov\nfrom pyCATHY.DA import performance\nfrom pyCATHY.ERT import petro_Archie as Archie\nimport pyCATHY.meshtools as cathy_meshtools\nimport pyvista as pv\nimport pyCATHY.plotters.cathy_plots as cplt \nimport os \nimport numpy as np\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\n# set some default plotting parameters for nicer looking plots\nmpl.rcParams.update({\"axes.grid\":True, \n                     \"grid.color\":\"gray\", \n                     \"grid.linestyle\":'--',\n                     'figure.figsize':(6,6)}\n                   )\nimport pandas as pd\nimport utils","key":"oMUmkclUOy"},{"type":"output","id":"HXur77igFViJX2Uin5ltG","data":[],"key":"yRXyghaicY"}],"key":"xqr1RpHjNs"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"import pygimli as pg \nfrom pygimli.physics import ert","key":"TI9PKrSTk9"},{"type":"output","id":"bcXiGEMKxlnIfMBwc26r6","data":[],"key":"MSdynqwooK"}],"key":"xdqc8EVkoB"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Analysis of the results","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sSnHrgoQAj"}],"identifier":"plot_results","label":"plot_results","html_id":"plot-results","key":"teQri5W40m"}],"key":"zYpIHtZKJz"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reload solution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"F0DxilAZeb"}],"identifier":"reload-solution","label":"Reload solution","html_id":"reload-solution","implicit":true,"key":"tG2UYMqqkk"}],"key":"pbEJ6HGYFE"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"simu_solution = cathy_tools.CATHY(\n                                    dirName='./solution_ERT',\n                                    prj_name= 'weill_dataset',\n                                    notebook=True,\n                                  )\nsw_SOL, sw_SOL_times = simu_solution.read_outputs('sw')\npsi_SOL = simu_solution.read_outputs('psi')\n\nrootMap, rootMap_hd = simu_solution.read_inputs('root_map')\n\nsoil_SPP_SOL, soil_FP_SOL = simu_solution.read_inputs('soil',\n                                                         MAXVEG=int(np.max(rootMap)),\n                                                    )\nPERMX_SOL = soil_SPP_SOL['PERMX'].unique()[0]\nPOROS_SOL = soil_SPP_SOL['POROS'].unique()[0]","key":"NcM5to3hZa"},{"type":"output","id":"T6IeAswjFXxIWd9811eve","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}}],"key":"aRVMZIXaDm"}],"key":"ZJBc3UQpDl"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot saturation 2D solution","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jTMQC7gPlL"}],"identifier":"plot-saturation-2d-solution","label":"Plot saturation 2D solution","html_id":"plot-saturation-2d-solution","implicit":true,"key":"iroHsNNdq3"}],"key":"I6Ix85Cxt1"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"pl = pv.Plotter(shape=(2, 2))\naxis_pl = [(0,0),(0,1),(1,0),(1,1)]\nfor i, j in enumerate([0,2,5,10]):\n    mesh = pv.read(os.path.join(simu_solution.workdir,\n                                'solution_ERTsaturation_nearIntrp2_pg_msh' + str(j) + '.vtk',\n                                )\n    \n           )\n    pl.subplot(axis_pl[i][0],axis_pl[i][1])\n    pl.add_mesh(mesh,\n               scalars='saturation_nearIntrp2_pg_msh',\n                lighting=False,\n                cmap=\"jet_r\"\n               )\n    pl.view_xz()\npl.show()","key":"gVFp9fPMNF"},{"type":"output","id":"uanRxPesKXhUGuYgQW9vv","data":[{"output_type":"display_data","metadata":{},"data":{"image/jpeg":{"content_type":"image/jpeg","hash":"6e31cb55382345f831227f14f8430ca4","path":"/build/6e31cb55382345f831227f14f8430ca4.jpeg"},"image/png":{"content_type":"image/png","hash":"6ae9872eb651581ce270554502af7ba2","path":"/build/6ae9872eb651581ce270554502af7ba2.png"},"text/plain":{"content":"<PIL.Image.Image image mode=RGB size=1024x768>","content_type":"text/plain"}}}],"key":"HJ1Dpf9Tb5"}],"key":"qAsYsrnqPM"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Going further with pygimli Time Lapse","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CaexXv6VmN"}],"identifier":"going-further-with-pygimli-time-lapse","label":"Going further with pygimli Time Lapse","html_id":"going-further-with-pygimli-time-lapse","implicit":true,"key":"PiRMSgWGjL"}],"key":"uVqrClcMMd"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In case we want to see the results in term of ER, we can invert the apparent resistivities. See: ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gb9ytFcZFR"},{"type":"link","url":"https://www.pygimli.org/_examples_auto/3_ert/plot_09_timelapse.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://‚Äãwww‚Äã.pygimli‚Äã.org‚Äã/‚Äã_examples‚Äã_auto‚Äã/3‚Äã_ert‚Äã/plot‚Äã_09‚Äã_timelapse‚Äã.html","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DL8Gqa0Ez5"}],"urlSource":"https://www.pygimli.org/_examples_auto/3_ert/plot_09_timelapse.html","key":"Ifbw4d9IaF"}],"key":"ciGZyeZB7s"},{"type":"code","lang":"","value":"for i in range(10):\n    rhoa = pg.load('filenameRhoa_synthetic')\n    DATA.append(rhoa)\n\ntl = ert.TimelapseERT(DATA)\ntl.invert(zWeight=0.3, lam=100)\ntl.showAllModels();","position":{"start":{"line":3,"column":1},"end":{"line":11,"column":1}},"key":"DU73ZUAwOj"}],"key":"iupS1dzMH0"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reload DA results","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OegtpLwA29"}],"identifier":"reload-da-results","label":"Reload DA results","html_id":"reload-da-results","implicit":true,"key":"stnEa4HzaL"}],"key":"nZ3OZj4PMs"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"simuWithDA = DA(\n                        dirName='./DA_ERT',\n                        prj_name= 'Weill_example_withDA',\n                        notebook=True,\n                    )\nsimuWithoutDA = DA(\n                        dirName='./DA_ERT',\n                        prj_name= 'Weill_example_withoutDA',\n                        notebook=True,\n                    )","key":"S90JonUtwv"},{"type":"output","id":"nZ-rFRxXD1XyNfaAc9ZJ7","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\">üèÅ <span style=\"font-weight: bold\">Initiate CATHY object</span>\n</pre>\n","content_type":"text/html"},"text/plain":{"content":"üèÅ \u001b[1mInitiate CATHY object\u001b[0m\n","content_type":"text/plain"}}}],"key":"r78svRuVvY"}],"key":"SktQdRpZ3q"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA = simuWithDA.load_pickle_backup()\nresults_withoutDA = simuWithoutDA.load_pickle_backup()","key":"WKmYBPNpvE"},{"type":"output","id":"V0jrpw8hmjoqGvu9CSefV","data":[],"key":"E8d62wJ0fb"}],"key":"DNL2jhXwlj"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"observations = dictObs_2pd(results_withDA['dict_obs'])\n#observations.xs('ERT',0).iloc[0]['elecs']","key":"cXg8vdOy5b"},{"type":"output","id":"xpsdawXIf3dQ2z0BzR7Rk","data":[],"key":"AfsFtdYk2e"}],"key":"rGC41S8OJr"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"tobs= observations.index.get_level_values(1).to_list()","key":"ChjW70aHir"},{"type":"output","id":"70iJIKknpXphXJhegDlnF","data":[],"key":"VFLcbh2x4C"}],"key":"wflbPfDlGY"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"ERT simulate","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DmCr4X5KoY"}],"identifier":"ert-simulate","label":"ERT simulate","html_id":"ert-simulate","implicit":true,"key":"sFwpcc2z14"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here we simulate the apparent resistivities from the mean/min/max of the ensemble generated from data assimilation for each steps.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"LY3wgtGqwK"}],"key":"qgcx5JL3Bi"}],"key":"FqxUPFXXx6"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"os.getcwd()","key":"ZlGjkkiaGT"},{"type":"output","id":"e0nQ7a6NElPw1q6y4l-7r","data":[{"output_type":"execute_result","execution_count":16,"metadata":{},"data":{"text/plain":{"content":"'/home/z0272571a@CAMPUS.CSIC.ES/Nextcloud/BenCSIC/Codes/BenjMy/ETH_pyCATHY/notebooks'","content_type":"text/plain"}}}],"key":"QnFKM17kP1"}],"key":"RCigq974hc"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshCiPG_PGref = pv.read('./solution_ERT/meshCi.vtk')\nmeshLiPG_PGref = pv.read('./solution_ERT/meshLi.vtk')\n(meshCiPG, meshLiPG) = utils.define_mesh_transformations(meshCiPG_PGref,\n                                                      meshLiPG_PGref,\n                                                      idC=10, \n                                                      idL=10,\n                                                    )","key":"u3yjDZmDGr"},{"type":"output","id":"SB4AQS_HmrOp52HkR8wjD","data":[],"key":"Tce8HxSoDZ"}],"key":"rLa08YW8Gf"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLiPG","key":"VvwAnl9ayh"},{"type":"output","id":"gHi7YMcF_6lAjorSktlaB","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content":"<table style='width: 100%;'><tr><th>Header</th><th>Data Arrays</th></tr><tr><td>\n<table style='width: 100%;'>\n<tr><th>UnstructuredGrid</th><th>Information</th></tr>\n<tr><td>N Cells</td><td>3114</td></tr>\n<tr><td>N Points</td><td>1658</td></tr>\n<tr><td>X Bounds</td><td>0.000e+00, 1.000e+01</td></tr>\n<tr><td>Y Bounds</td><td>5.000e+00, 5.000e+00</td></tr>\n<tr><td>Z Bounds</td><td>-1.000e+00, 7.500e-01</td></tr>\n<tr><td>N Arrays</td><td>1</td></tr>\n</table>\n\n</td><td>\n<table style='width: 100%;'>\n<tr><th>Name</th><th>Field</th><th>Type</th><th>N Comp</th><th>Min</th><th>Max</th></tr>\n<tr><td><b>Marker</b></td><td>Cells</td><td>float64</td><td>1</td><td>1.000e+00</td><td>1.000e+00</td></tr>\n</table>\n\n</td></tr> </table>","content_type":"text/html"},"text/plain":{"content":"UnstructuredGrid (0x7f3651daa860)\n  N Cells:    3114\n  N Points:   1658\n  X Bounds:   0.000e+00, 1.000e+01\n  Y Bounds:   5.000e+00, 5.000e+00\n  Z Bounds:   -1.000e+00, 7.500e-01\n  N Arrays:   1","content_type":"text/plain"}}}],"key":"UJc7OjvagC"}],"key":"wGGSK5H0zy"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"meshLiPG is composed of 3114 cells and 1658 nodes","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M4BtcRKHaj"}],"key":"XPb3C7e6Af"}],"key":"sDj11q6dik"}],"key":"R8Q3xu5Bbz"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"pl = pv.Plotter()\npl.add_mesh(meshCiPG)\npl.add_mesh(meshLiPG)\n#pl.add_mesh(meshCATHY,opacity=0.5)\npl.show_grid()\npl.show()","key":"uZCirgWOiD"},{"type":"output","id":"PlgmJrdEdOIfVXMdfoofS","data":[{"output_type":"display_data","metadata":{},"data":{"image/jpeg":{"content_type":"image/jpeg","hash":"3d94c89eece1c805a6a26d55da8602f4","path":"/build/3d94c89eece1c805a6a26d55da8602f4.jpeg"},"image/png":{"content_type":"image/png","hash":"0a59c637b77ab96fdbe7b19cf8fa1d13","path":"/build/0a59c637b77ab96fdbe7b19cf8fa1d13.png"},"text/plain":{"content":"<PIL.Image.Image image mode=RGB size=1024x768>","content_type":"text/plain"}}}],"key":"ZHLPKYl9r9"}],"key":"I0lalIZGJI"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"ERT_meta_dict_meshLi={\n                'forward_mesh_vtk_file': './solution_ERT/meshLi.vtk',\n                'mesh_nodes_modif': meshLiPG.points\n}","key":"TXL3IDeQoA"},{"type":"output","id":"qVuIuHEGHjwwQmRr1s0HS","data":[],"key":"NIJBGacq8v"}],"key":"vW4AZ4aBXD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define Archie Parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WIPVeDXzxO"}],"identifier":"define-archie-parameters","label":"Define Archie Parameters","html_id":"define-archie-parameters","implicit":true,"key":"uulSU2uVX7"}],"key":"XOQCIRzrrs"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"sc = {}\nrFluid_Archie = 1/(588*(1e-6/1e-2))\nsc = {\n    \"POROS\": [POROS_SOL],\n    \"rFluid_Archie\": [rFluid_Archie],\n    \"a_Archie\": [0.3],\n    \"m_Archie\": [1.7],\n    \"n_Archie\": [1.7],\n    \"pert_sigma_Archie\": [0],\n}","key":"pmrwGmyeqM"},{"type":"output","id":"Nnr-1NwlsXH5Pd9SBnHGT","data":[],"key":"jDGX8yZpiz"}],"key":"j7wbCpswMK"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"","key":"IshGpuS8Du"},{"type":"output","id":"Q0CcXniJCYfgm2sA_03el","data":[{"ename":"NameError","evalue":"name 'meshCATHY' is not defined","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mNameError\u001b[0m                                 Traceback (most recent call last)\nCell \u001b[0;32mIn[32], line 1\u001b[0m\n\u001b[0;32m----> 1\u001b[0m meshLi_PG_withSaturation, scalar_new \u001b[38;5;241m=\u001b[39m cathy_meshtools\u001b[38;5;241m.\u001b[39mCATHY_2_pg(meshCATHY,\n\u001b[1;32m      2\u001b[0m                                                                   ERT_meta_dict_meshLi,\n\u001b[1;32m      3\u001b[0m                                                                   \u001b[38;5;66;03m# show=True,\u001b[39;00m\n\u001b[1;32m      4\u001b[0m                                                                   )\n\n\u001b[0;31mNameError\u001b[0m: name 'meshCATHY' is not defined"}],"key":"OCU3oCtP83"}],"key":"D17a6PFpah"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create ERT scheme","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LqPIXyOJaT"}],"identifier":"create-ert-scheme","label":"Create ERT scheme","html_id":"create-ert-scheme","implicit":true,"key":"Yo3ozOUdVs"}],"key":"xNyARZkkCJ"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"scheme = ert.createData(elecs=np.linspace(start=0, \n                                          stop=10, \n                                          num=21),\n                           schemeName='dd')","key":"hUbCKP6wmW"},{"type":"output","id":"bswYwbwPfKNGtQf3BlTJM","data":[],"key":"RAKLy2izfq"}],"key":"l7dbbIMKNB"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLi = pg.load(ERT_meta_dict_meshLi['forward_mesh_vtk_file'])","key":"Ik1MLvJKul"},{"type":"output","id":"G4hbMru5DR0d6EADWjQIf","data":[],"key":"IrUkGEsaVr"}],"key":"AGghJETmaQ"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"sw_bef_update_withDA_ens1 = results_withDA['df_DA'].set_index(['time','Ensemble_nb'])['sw_bef_update_'].xs((1,0))","key":"RZFc76alxg"},{"type":"output","id":"BYcHTnMQl4qEDG2KHu-7b","data":[],"key":"tzAtajxxRt"}],"key":"HOdmjabhEe"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA_Archie = results_withDA['df_Archie'].set_index(['time','ens_nbi'])\nresults_withDA_Archie","key":"hNL2Tnm11W"},{"type":"output","id":"gaN94tNF73_vS79Y1yP1a","data":[{"output_type":"execute_result","execution_count":24,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th>ens_nb</th>\n      <th>sw</th>\n      <th>ER_converted</th>\n      <th>OL</th>\n      <th>porosity</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th>ens_nbi</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">0.0</th>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672994</td>\n      <td>27.638137</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672602</td>\n      <td>27.665519</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672672</td>\n      <td>27.660611</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672713</td>\n      <td>27.657710</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>0.0</th>\n      <td>NaN</td>\n      <td>0.672787</td>\n      <td>27.652588</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">9.0</th>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313890</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272770</td>\n      <td>128.313970</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n    <tr>\n      <th>31.0</th>\n      <td>NaN</td>\n      <td>0.272769</td>\n      <td>128.314130</td>\n      <td>0.0</td>\n      <td>0.55</td>\n    </tr>\n  </tbody>\n</table>\n<p>1439424 rows √ó 5 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"             ens_nb        sw  ER_converted   OL  porosity\ntime ens_nbi                                              \n0.0  0.0        NaN  0.672994     27.638137  0.0      0.55\n     0.0        NaN  0.672602     27.665519  0.0      0.55\n     0.0        NaN  0.672672     27.660611  0.0      0.55\n     0.0        NaN  0.672713     27.657710  0.0      0.55\n     0.0        NaN  0.672787     27.652588  0.0      0.55\n...             ...       ...           ...  ...       ...\n9.0  31.0       NaN  0.272770    128.313890  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272770    128.313970  0.0      0.55\n     31.0       NaN  0.272769    128.314130  0.0      0.55\n\n[1439424 rows x 5 columns]","content_type":"text/plain"}}}],"key":"TjbUt9TJyv"}],"key":"A55fkVdaZF"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"rhomap = results_withDA_Archie.xs((0,0))['ER_converted'].values\nlen(rhomap)\n","key":"CsNy3AyApV"},{"type":"output","id":"gnH2PeRANy_8r5ZHTIlUN","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"text/plain":{"content":"7056","content_type":"text/plain"}}}],"key":"z7IWqw4yid"}],"key":"nsrEzmn5tf"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"len(rhomap)","key":"BtmXgLc9zr"},{"type":"output","id":"VttAK5fePy8e847ajM_Yb","data":[{"output_type":"execute_result","execution_count":31,"metadata":{},"data":{"text/plain":{"content":"7056","content_type":"text/plain"}}}],"key":"Ou632QWZW8"}],"key":"TZooIguKVh"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meshLi","key":"dE2GUQ80Qt"},{"type":"output","id":"UcI0p2sZ7t5X8aaMRvkpi","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"Mesh: Nodes: 1658 Cells: 3114 Boundaries: 4771\nMesh contains data: Marker","content_type":"text/plain"}}}],"key":"IiKZWXQEHr"}],"key":"JLpQtaHXC2"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"os.getcwd()","key":"T6VxQwuNoY"},{"type":"output","id":"12s_5cC9kPTy1c8mdBO5T","data":[{"output_type":"execute_result","execution_count":28,"metadata":{},"data":{"text/plain":{"content":"'/home/z0272571a@CAMPUS.CSIC.ES/Nextcloud/BenCSIC/Codes/BenjMy/ETH_pyCATHY/notebooks'","content_type":"text/plain"}}}],"key":"R6eDNCIde1"}],"key":"xPau8M62Uq"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"for i in range(len(tatmbc)):\n\n    # read in CATHY mesh data\n    # ------------------------------------------------------------------------\n    path_CATHY = os.path.join(simu_solution.workdir, \n                              simu_solution.project_name , \n                              'vtk/'\n                              )\n    if i<10:    \n        filename = \"10\" + str(i) + \".vtk\"\n    elif i<100:\n        filename = \"1\" + str(i) + \".vtk\"\n    \n    meshCATHY = pv.read(path_CATHY+filename)\n            \n    meshLi_PG_withSaturation, scalar_new = cathy_meshtools.CATHY_2_pg(meshCATHY,\n                                                                      ERT_meta_dict_meshLi,\n                                                                      # show=True,\n                                                                      )","key":"wdg3zXZTxs"},{"type":"output","id":"Lgha7R8Renrm-45L6N0mM","data":[],"key":"L3lOktd6ST"}],"key":"QeIErozdlj"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"\nfor i in range(len(tobs)):\n    rhomap = results_withDA_Archie.xs((0,0))['ER_converted'].values\n    print(rhomap)\n\n    meshLi_PG_withSaturation, scalar_new = cathy_meshtools.CATHY_2_pg(meshCATHY,\n                                                                  ERT_meta_dict_meshLi,\n                                                                  # show=True,\n                                                                  )\n\n    ER_converted_ti_noNoise = Archie.Archie_rho_DA(\n                                               sat = [saturation],\n                                               rFluid_Archie=sc['rFluid_Archie'], \n                                               porosity=sc['POROS'], \n                                               a_Archie=sc['a_Archie'], \n                                               m_Archie=sc['m_Archie'], \n                                               n_Archie=sc['n_Archie'],\n                                               pert_sigma_Archie=[0]\n                                               )\n\n    data = ert.simulate(meshLi, \n                        scheme=scheme, \n                        res=rhomap, \n                        noiseLevel=1,\n                        noiseAbs=1e-6, \n                        seed=1337\n                        )\n    print(i)\n    data.save('DA_ERT/ERTsimuWithDA/ERT_Li_' + str(i) + '.data')","key":"Aki8kdEenL"},{"type":"output","id":"RY5Akq4knrbLKVYt_dS5a","data":[{"name":"stdout","output_type":"stream","text":"[27.6381372  27.66551909 27.66061108 ... 14.09702132 14.09702132\n 14.09702132]\nModellingBase::setMesh() copying new mesh ... Found Neumann domain. Setting topography=1.\nFound Neumann domain. but 2.5D -> neumann: false\nMesh: Nodes: 1658 Cells: 3114 Boundaries: 4771\nMesh contains data: Marker\nres:  [27.6381372  27.66551909 27.66061108 ... 14.09702132 14.09702132\n 14.09702132]\nFound datafile: 21 electrodes\nFound: 21 free-electrodes\nrMin = 0.25, rMax = 20\nNGauLeg + NGauLag for inverse Fouriertransformation: 11 + 4\nFound non-Neumann domain\n0.00733017 s\nFOP updating mesh dependencies ... 1.072e-06 s\n"},{"ename":"BaseException","evalue":"Simulate called with wrong resistivity array.","output_type":"error","traceback":"\u001b[0;31m---------------------------------------------------------------------------\u001b[0m\n\u001b[0;31mBaseException\u001b[0m                             Traceback (most recent call last)\nCell \u001b[0;32mIn[29], line 4\u001b[0m\n\u001b[1;32m      2\u001b[0m rhomap \u001b[38;5;241m=\u001b[39m results_withDA_Archie\u001b[38;5;241m.\u001b[39mxs((\u001b[38;5;241m0\u001b[39m,\u001b[38;5;241m0\u001b[39m))[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mER_converted\u001b[39m\u001b[38;5;124m'\u001b[39m]\u001b[38;5;241m.\u001b[39mvalues\n\u001b[1;32m      3\u001b[0m \u001b[38;5;28mprint\u001b[39m(rhomap)\n\u001b[0;32m----> 4\u001b[0m data \u001b[38;5;241m=\u001b[39m ert\u001b[38;5;241m.\u001b[39msimulate(meshLi, \n\u001b[1;32m      5\u001b[0m                     scheme\u001b[38;5;241m=\u001b[39mscheme, \n\u001b[1;32m      6\u001b[0m                     res\u001b[38;5;241m=\u001b[39mrhomap, \n\u001b[1;32m      7\u001b[0m                     noiseLevel\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1\u001b[39m,\n\u001b[1;32m      8\u001b[0m                     noiseAbs\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1e-6\u001b[39m, \n\u001b[1;32m      9\u001b[0m                     seed\u001b[38;5;241m=\u001b[39m\u001b[38;5;241m1337\u001b[39m\n\u001b[1;32m     10\u001b[0m                     )\n\u001b[1;32m     11\u001b[0m \u001b[38;5;28mprint\u001b[39m(i)\n\u001b[1;32m     12\u001b[0m data\u001b[38;5;241m.\u001b[39msave(\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mDA_ERT/ERTsimuWithDA/ERT_Li_\u001b[39m\u001b[38;5;124m'\u001b[39m \u001b[38;5;241m+\u001b[39m \u001b[38;5;28mstr\u001b[39m(i) \u001b[38;5;241m+\u001b[39m \u001b[38;5;124m'\u001b[39m\u001b[38;5;124m.data\u001b[39m\u001b[38;5;124m'\u001b[39m)\n\nFile \u001b[0;32m~/miniconda3/envs/pgCATHY/lib/python3.11/site-packages/pygimli/physics/ert/ert.py:215\u001b[0m, in \u001b[0;36msimulate\u001b[0;34m(mesh, scheme, res, **kwargs)\u001b[0m\n\u001b[1;32m    213\u001b[0m         \u001b[38;5;28mprint\u001b[39m(mesh)\n\u001b[1;32m    214\u001b[0m         \u001b[38;5;28mprint\u001b[39m(\u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mres: \u001b[39m\u001b[38;5;124m\"\u001b[39m, res)\n\u001b[0;32m--> 215\u001b[0m         \u001b[38;5;28;01mraise\u001b[39;00m \u001b[38;5;167;01mBaseException\u001b[39;00m(\n\u001b[1;32m    216\u001b[0m             \u001b[38;5;124m\"\u001b[39m\u001b[38;5;124mSimulate called with wrong resistivity array.\u001b[39m\u001b[38;5;124m\"\u001b[39m)\n\u001b[1;32m    218\u001b[0m \u001b[38;5;28;01mif\u001b[39;00m \u001b[38;5;129;01mnot\u001b[39;00m isArrayData:\n\u001b[1;32m    219\u001b[0m     ret[\u001b[38;5;124m'\u001b[39m\u001b[38;5;124mrhoa\u001b[39m\u001b[38;5;124m'\u001b[39m] \u001b[38;5;241m=\u001b[39m rhoa\n\n\u001b[0;31mBaseException\u001b[0m: Simulate called with wrong resistivity array."}],"key":"cJjd3nDtcE"}],"key":"adXorq1cyQ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Archie","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ozZyzNptTG"}],"identifier":"archie","label":"Archie","html_id":"archie","implicit":true,"key":"hLhBgAtLAZ"}],"key":"I8dT5M0zhP"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"results_withDA.keys()","key":"SItSkTbe2P"},{"type":"output","id":"Bi1K66l2rWMwOXeDsNmxx","data":[],"key":"LnWUmSKRdK"}],"key":"cWOCf3f755"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie = results_withDA['df_Archie']\nArchie_ER = Archie.set_index(['time','ens_nbi'])\nArchie_ER","key":"Pi4jxvrRYx"},{"type":"output","id":"0i-cWHkJ0-GM8nukjfcuj","data":[],"key":"WF1kWcZ7fW"}],"key":"MokWh981PS"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie.time.unique()","key":"I9GVWl9OdL"},{"type":"output","id":"HtZvDw_zNFKRiLsKf9D0z","data":[],"key":"Gle59dGISo"}],"key":"IKWMWHPYhR"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"meanArchie = Archie.groupby('time')['ER_converted'].mean()\nminArchie = Archie.groupby('time')['ER_converted'].min()\nmaxArchie = Archie.groupby('time')['ER_converted'].max()\nminArchie","key":"HDOAtltahd"},{"type":"output","id":"cJWmf6_vtqJVrfMCKGmDE","data":[],"key":"eN6ZGzXvdb"}],"key":"lcJUKAjJLh"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots()\nminArchie.plot(ax=ax)\nmaxArchie.plot(ax=ax)\nmeanArchie.plot(ax=ax)\nax.set_xlabel('# Assimilation')\nax.set_ylabel('ER converted')\n","key":"LbHFoV5ee9"},{"type":"output","id":"4ehziH3zNVJXEzYlWlbMQ","data":[],"key":"kZ9NyJXmt8"}],"key":"zFQ3u9I4A6"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot 1:1 line between observed ER and estimated ER","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"kWMlKOAbq8"}],"identifier":"plot-1-1-line-between-observed-er-and-estimated-er","label":"Plot 1:1 line between observed ER and estimated ER","html_id":"plot-1-1-line-between-observed-er-and-estimated-er","implicit":true,"key":"uHisq3uI5n"}],"key":"LMVb9r0dQm"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"Archie['ER_converted']","key":"QrvH3jXiSL"},{"type":"output","id":"-mt5qD5m5QI-_HdSH5E3q","data":[],"key":"erLOhEyO2O"}],"key":"CKXRigjbF4"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"metadata_ERT    = {\n                    'data_type': '$ERT$', # units\n                    'units': '$\\Ohm$', # units transfer_resistances\n                    'forward_mesh_vtk_file': '../solution_ERT/meshLi.vtk', # path to the ERT mesh (vtk file compatible with pygimli or resipy)\n                    # 'sequenceERT': sequenceERT, # path to the ERT sequence  (file compatible with pygimli or resipy)\n                    # 'instrument': 'Syscal', # Instrument\n                    'data_format': 'pygimli', # format (raw or preprocessed)\n                    'dataErr': 0.5, # error in %\n                    'fwdNoiseLevel': 5, # error in %\n                    #'mesh_nodes_modif': meshLiPG.points, \n        \n                }","key":"eR4dz7lreZ"},{"type":"output","id":"xauk-GIwoSytU_EQiMWCP","data":[],"key":"Ty0J3vbgm7"}],"key":"VlSPXxgB5H"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"dict_obs = {}\nfor i, tt in enumerate(Archie.time.unique()):\n\n    if i == 0:\n        continue\n    \n    # .data file observation generated by pygimli\n    filename = os.path.join(simu_solution.workdir,\n                            'ERTsolution', \n                            'ERT_Li_' + str(i) + '.data'\n                            )    \n    data_measure = read_observations(\n                                    dict_obs,\n                                    filename, \n                                    data_type = 'ERT', \n                                    data_err = 0.5,\n                                    show=True,\n                                    tA=tt,\n                                    obs_cov_type='data_err', #data_err\n                                    meta=metadata_ERT,\n                                    ) \ndata_measure_df = dictObs_2pd(dict_obs) ","key":"n7juoo2OCu"},{"type":"output","id":"ZjOMAREZM9YUKaN-pRLoV","data":[],"key":"Sv0QvN9oY9"}],"key":"Jtv0cPv1B0"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data_rhoa = data_measure_df.xs('ERT')['data']\ndata_rhoa.iloc[0].head()","key":"UuE3GHHmOf"},{"type":"output","id":"J4MyNuWHzhg4b2-xzteWv","data":[],"key":"IJ2aRlnJbV"}],"key":"RiReXeQT7z"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"fig, ax = plt.subplots() \nax.scatter(data_rhoa.iloc[0]['rhoa'].values,\n           Archie.groupby('ens_nbi')['ER_converted'].mean().values\n          )\n           ","key":"PEB2KLigJo"},{"type":"output","id":"-4lJyrQI5O7JSYzTKVrJu","data":[],"key":"n1WDEpyWOs"}],"key":"UmXCVxhxVa"}],"key":"ZRZCPv3QaE"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Working with pyCATHY and DA with ERT datasets","url":"/da-ert-part3-results-archie-inprogress","group":"Notebook"},"next":{"title":"Working with pyCATHY and DA","url":"/da-smc-sensors-part1-solution","group":"Notebook"}}},"domain":"http://localhost:3000"}